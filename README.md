# simple-analytics

Super simple analytics script that tracks visits of your pages. It uses Supabase API by default but can be easily modified to send data to any backend.

## Features

- super small and simple
- tracks views per hostname and pathname, including date, referrer and user agent
- totally private
- easy to self-host, just create supabase project and run few SQL scripts
- tracks views by default, but can be extended to track anything by dispatching custom events

## Usage

Create a Supabase project and run the following SQL to prepare the database and user:

```sql
create table public.simple_analytics (
  id bigint generated by default as identity not null,
  url text null,
  hostname text null,
  pathname text null,
  timestamp timestamp with time zone null,
  referrer text null,
  user_agent text null,
  detail jsonb null,
  constraint simple_analytics_pkey primary key (id)
) TABLESPACE pg_default;

create policy "Enable insert for all users"
on "public"."simple_analytics"
as PERMISSIVE
for INSERT
to anon
with check (true);
```

Add script to tracked pages. The `prjectId`, `apiKey` and `table` are your Supabase project ID, anon public API key and a table name. You can check these in supabase dashboard of your project.

```html
<script src="/simple-analytics.js"></script>
<script>
  initSimpleAnalytics(
    projectId,
    apiKey,
    { table: "simple_analytics" },
  );
</script>
```

You can test it locally by adding `skipOriginCheck` in the config object. This enables tracking views from `file:` protocol and `localhost` hostname.

```html
<script src="./simple-analytics.js"></script>
<script>
  initSimpleAnalytics(
    projectId,
    apiKey,
    { table: "simple_analytics", skipOriginCheck: true },
  );
</script>
```

## Configuration

Some settings can be modified in the config object. These include:

- `skipOriginCheck` - skips checking ignored protocols, hostnames and pathnames entirely. Useful for testing. Default: `false`.
- `ignoreProtocol` - array of ignored protocols. Default: `['file:']`.
- `ignoreHostname` - array of ignored hostnames. Default: `['localhost']`.
- `ignorePathname` - array of ignored pathnames. Default: `[]`.
- `trackViewOncePerSession` - track views once per session. Default: `false`.
- `trackViewOncePerSessionKey` - key name of the sessionStorage property when `trackViewOncePerSession` is enabled.
- `trackOnCustomEvent` - adds listener for `sa-track` custom events to track any additional actions. The events detail is stored in database as JSON in the detail column. Default: `false`.
